<!DOCTYPE html>

<html lang="en" class="">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>海浪工作室</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="cn">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="msapplication-config" content="none">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="icon" href="" type="image/ico">

    <link type="text/css" rel="stylesheet" href="assets/plugs/bootstrap/css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="assets/css/cssreset.css">
    <link type="text/css" rel="stylesheet" href="assets/css/common.css?v=1.0.0">
    <link type="text/css" rel="stylesheet" href="assets/css/master.css?v=1.0.0">
</head>

<body data-screen-width="lg">
    <div class="body">
        <div id="header">
            <div class="header-top">
                <div class="bg hidden-xs hidden-sm"><img src="assets/images/header_bg.gif" width="100%"></div>
                <div class="mini-bg visible-xs visible-sm" style="background-image: url(assets/images/header_bg.gif);"></div>

                <div class="top-box">
                    <div class="logo">
                        <img src="assets/images/logo.png" width="100%">
                    </div>
                    <div class="search-box">
                        <div class="col-xs-9 col-sm-9 col-md-9">
                            <input type="text" placeholder="输入关键字">
                        </div>
                        <div class="col-xs-3 col-sm-3 col-md-3 text-right">
                            <a href="javascript:void(0);" class="search-btn"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></a>
                        </div>
                    </div>
                </div>

            </div>

            <div class="header-bottom hidden-xs hidden-sm">
                <div class="hl-container">
                    <div class="header-nav">
                        <div class="col-md-2">
                            <a href="#"><img src="assets/images/logo.png" class="logo"></a>
                        </div>
                        <div class="col-md-10">
                            <div class="col-sm-2 col-md-2"></div>
                            <div class="col-sm-2 col-md-2">
                                <a href="javascript:void(0);" class="active nav-item">
                                    <span>全部</span>
                                    <div class="hover-bg"></div>
                                </a>
                            </div>
                            <div class="col-sm-2 col-md-2">
                                <a href="javascript:void(0);" class="nav-item">
                                    <span>专题页</span>
                                    <div class="hover-bg"></div>
                                </a>
                            </div>
                            <div class="col-sm-2 col-md-2">
                                <a href="javascript:void(0);" class="nav-item">
                                    <span>H5</span>
                                    <div class="hover-bg"></div>
                                </a>
                            </div>
                            <div class="col-sm-2 col-md-2">
                                <a href="javascript:void(0);" class="nav-item">
                                    <span>平面</span>
                                    <div class="hover-bg"></div>
                                </a>
                            </div>
                            <div class="col-sm-2 col-md-2">
                                <a href="javascript:void(0);" class="nav-item">
                                    <span>已标记</span>
                                    <div class="hover-bg"></div>
                                </a>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="app">
            <div class="container">
                <div role="tabpanel">
                    <!-- Nav tabs -->
                    <!-- <ul class="nav nav-tabs" role="tablist">
                      <li role="presentation" class="active"><a href="#panel-1" aria-controls="panel-1" role="tab" data-toggle="tab">全部</a></li>
                      <li role="presentation"><a href="#panel-2" aria-controls="panel-2" role="tab" data-toggle="tab">专题</a></li>
                      <li role="presentation"><a href="#panel-3" aria-controls="panel-3" role="tab" data-toggle="tab">H5</a></li>
                      <li role="presentation"><a href="#panel-4" aria-controls="panel-4" role="tab" data-toggle="tab">平面</a></li>
                      <li role="presentation"><a href="#panel-5" aria-controls="panel-5" role="tab" data-toggle="tab">标签</a></li>
                      <li role="presentation"><a href="#panel-6" aria-controls="panel-6" role="tab" data-toggle="tab">搜索</a></li>
                    </ul> -->
                    <!-- Tab panes -->
                    <div class="tab-content">

                        <div role="tabpanel" class="tab-pane active" id="panel-1">
                            <div class="row masonry">
                                <!-- <div class="col-xs-6 col-sm-6 col-md-4 item">
                                    <div class="thumbnail">
                                        <img src="assets/images/demo2.jpg" alt="">
                                        <div class="img-wave"><img src="assets/images/wave_icon.png" alt=""></div>
                                        <div class="caption">
                                            <h3>广府庙会相约幸福主题h5</h3>
                                            <p>新浪广东携手广州越秀广府庙会组委会新浪广东携手广州越秀广府庙会组委会新浪广东携手广州越秀广府庙会组委会</p>
                                        </div>
                                        <div class="label-box"><span class="label label-diy">政府</span><span class="label label-diy">新浪</span><span class="label label-diy">扁平化</span><span class="label-icon pull-right"></span></div>
                                    </div>
                                </div> -->
                            </div>
                        </div><!--/.tab-panel -->
                        <div role="tabpanel" class="tab-pane" id="panel-2">
                            <div class="row masonry">

                            </div>
                        </div><!--/.tab-panel -->
                        <div role="tabpanel" class="tab-pane" id="panel-3">
                            <div class="row masonry">
                                
                            </div>
                        </div><!--/.tab-panel -->
                        <div role="tabpanel" class="tab-pane" id="panel-4">
                            <div class="row masonry">
                                
                            </div>
                        </div><!--/.tab-panel -->
                        <div role="tabpanel" class="tab-pane" id="panel-5">
                            <div class="row masonry">
                                
                            </div>
                        </div><!--/.tab-panel -->
                        <div role="tabpanel" class="tab-pane" id="panel-6">
                            <div class="row masonry">
                                
                            </div>
                        </div><!--/.tab-panel -->
                    </div>
                </div>

                <div class="bottom-logo"><img src="assets/images/b_logo.png" alt=""></div>
            </div>
            <div id="footer">
                <div class="footer-top"></div>
                <div class="footer-bottom">
                    <div class="visible-md visible-lg text-center">
                        <p>新浪广东意见反馈留言板 电话：4006900000 欢迎批评指正 爆料热线：020-85583938</p>
                        <p><a href="#">新浪广东简介</a> | <a href="#">网站地图</a> | <a href="#">营销服务</a> | <a href="#">广告刊例</a> | <a href="#">招聘英才</a> | <a href="#">联系我们</a> | <a href="#">网站律师</a> | <a href="#">SINA English</a> | <a href="#">通行证注册</a> | <a href="#">产品答疑</a></p>
                        <p>Copyright © 1996 - 2016 SINA Corporation, All Rights Reserved</p>
                    </div>
                    <div class="visible-xs visible-sm text-center">
                        <p>Copyright © 1996 - 2016 SINA Corporation, All Rights Reserved</p>
                        <p>新浪公司版权所有</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div id="mini-nav" class="visible-xs visible-sm">
        <ul>
            <li class="mobile-nav-item"></li>
            <li class="mobile-nav-item"></li>
            <li class="mobile-nav-item"></li>
            <li class="mobile-nav-item"></li>
            <li class="mobile-nav-item"></li>
        </ul>

    </div>
    <div id="mask" style="display: none"></div>

    <div id="pop">

        <div class="pop-content container">
            
            <div class="row">
                
            </div>
        </div>
    </div>
    <div class="pop-close"><span><img src="assets/images/pop_close.png" alt=""></span></div>

    <script src="assets/plugs/jquery/jquery-2.1.4.min.js"></script>

    <script type="text/javascript" src="http://guangdong.sinaimg.cn/subject/2016/0805/jquery.qrcode.min.js"></script>

    <script src="assets/plugs/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/plugs/masonry/masonry.min.js"></script>
    <script src="assets/plugs/masonry/imagesloaded.min.js"></script>
    <script src="assets/project/data.js"></script>
    <script>

    var allItemsData = [];
    var indexId = 1;
    allItemsDataTemp[0].id = indexId;
    allItemsDataTemp[0].isTag = 0;
    allItemsData.push(allItemsDataTemp[0]);
    for(var i = allItemsDataTemp.length - 1; i > 0; i--) {
        var item = allItemsDataTemp[i];
        indexId++;
        item.id = indexId;
        item.isTag = 0;
        allItemsData.push(item);
    }

    var allmasonrysData = [];
    
    var $masonrys = $('.masonry');
    var curMasIndex = 0;
    var step = 6;
    for(var i = 0; i < $masonrys.length; i++) {
        var data = {};
        data.masonry = $masonrys.eq(i);
        data.imagesLoading = false;
        data.currentIndex = 0;
        data.itemsIds = [];
        allmasonrysData.push(data);
    }
    for(var i = 0, len = allItemsData.length; i < len; i++) {
        var curItemId = allItemsData[i].id;
        allmasonrysData[0].itemsIds.push(curItemId);
        if(allItemsData[i].type == 1 || allItemsData[i].type == 4) {
            allmasonrysData[1].itemsIds.push(curItemId);
        }
        if(allItemsData[i].type == 2 || allItemsData[i].type == 4) {
            allmasonrysData[2].itemsIds.push(curItemId);
        }
        if(allItemsData[i].type == 3 || allItemsData[i].type == 4) {
            allmasonrysData[3].itemsIds.push(curItemId);
        }
    }
    (function() {
        function getNewItems(masIndex, start, length) {
            var resultArr = [];
            var len = start + length;
            var itemsArr = allmasonrysData[masIndex].itemsIds;
            len = len > itemsArr.length ? itemsArr.length : len;  
            for(var i = start; i < len; i++) {
                resultArr.push(itemsArr[i]);
            }
            allmasonrysData[masIndex].currentIndex = len;
            
            var html = createHTML(resultArr);
            var newItemContainer = $('<div/>');
            newItemContainer.html(html);
            return newItemContainer.find('.item');
        }
        function createHTML(resultArr) {
            var html = '';
            for(var i = 0; i < resultArr.length; i++) {
                var result = allItemsData[resultArr[i]-1];
                html += '<div class="col-xs-6 col-sm-6 col-md-4 item">';
                html += '<div class="thumbnail" data-id="' + result.id + '">';
                html += '<img src="' + result.mainImg + '" alt="">';
                if(result.type != 4) {
                    html += '<div class="img-wave"><img src="assets/images/wave_icon.png" alt=""></div>';
                    html += '<div class="caption">';
                    html += '<h3>' + result.title + '</h3>';
                    html += '<p>' + result.desc + '</p>';
                    html += '</div>';
                    html += '<div class="label-box">';
                    for(var j = 0; j < result.keywords.length; j++) {
                        html += '<span class="label label-diy">' + result.keywords[j] + '</span>';
                    }
                    if(result.isTag) {
                        html += '<span class="label-icon pull-right active"></span></div>';
                    }else {
                        html += '<span class="label-icon pull-right"></span></div>';
                    }
                    
                }
                html += '</div></div>';
            }
            return html;
        }
        function initMasonry() {
            for(var i = 0; i < allmasonrysData.length; i++) {
                (function(i) {
                    var items = getNewItems(i, allmasonrysData[i].currentIndex, 6).css('opacity', 0);
                    allmasonrysData[i].masonry.append(items);
                    allmasonrysData[i].imagesLoading = true;
                    items.imagesLoaded(function(){
                        allmasonrysData[i].imagesLoading = false;
                        items.css('opacity', 1);
                        allmasonrysData[i].masonry.masonry({
                            columnWidth: '.item',
                            itemSelector: '.item'
                        });
                        resetEventHandler(); 
                    });
                })(i);
            }

            //Reinitialize masonry inside each panel after the relative tab link is clicked - 
            var $panels = $(".tab-pane");
            var $navs = $(".nav-item");
            var $mobile_navs = $("#mini-nav").find(".mobile-nav-item");
            navHandler($navs);
            navHandler($mobile_navs);
            function navHandler(nav) {
                nav.each(function () {
                    var $this = $(this);
                    
                    $this.on('click', function () {
                        nav.removeClass("active");
                        $(this).addClass("active");
                        var index = nav.index($(this));
                        curMasIndex = index;
                        $panels.removeClass("active");
                        $panels.eq(index).addClass("active");
                        if(index == 4) {
                            allmasonrysData[index].masonry.masonry('destroy');
                        }
                        allmasonrysData[index].imagesLoading = true;
                        allmasonrysData[index].masonry.imagesLoaded( function () {
                            allmasonrysData[index].imagesLoading = false;
                            allmasonrysData[index].masonry.masonry({
                                columnWidth: '.item',
                                itemSelector: '.item'
                            });
                        });

                    }); //end shown
                });  //end each
            }
        }
        
        function appendToMasonry(masIndex, len, callback) {
            if(len) {
                var length = len;
            }else {
                var length = step;
            }
            var items = getNewItems(masIndex, allmasonrysData[masIndex].currentIndex, length).css('opacity', 0);
            allmasonrysData[masIndex].masonry.append(items);
            allmasonrysData[masIndex].imagesLoading = true;
            items.imagesLoaded(function(){
                allmasonrysData[masIndex].imagesLoading = false;
                items.css('opacity', 1);
                allmasonrysData[masIndex].masonry.masonry('appended',  items);
                resetEventHandler(); 
                callback && callback();
            });
        }
        function canvasSupport() {
            return !!document.createElement('canvas').getContext;
        }
        function resetEventHandler() {
            var $items = $(".tab-content .thumbnail");
            $items.off("click");
            $items.find(".label-box").off("click");
            $items.find(".label-icon").off("click");
            $items.on("click", function() {
                var id = parseInt($(this).attr("data-id"));
                if(id && id != 1) {
                    $(".body").css({
                        "overflow": "hidden"
                    });
                    $("#pop").find(".row").html(getDetailHTML(id));
                    $("#pop").addClass("active");
                    $(".pop-close").addClass("active");
                    $("#pop").scrollTop(0);

                    var $wrapper = $(".qrcode-pic");
                    var text_url = $wrapper.attr("data-url");
                    $wrapper.addClass("active");
                    var width = $wrapper.width()*0.8;
                    $wrapper.removeClass("active");
                    var height = width;
                    $(".qrcode-pic").qrcode({ 
                        render: renderWay, //table方式 
                        width: width, //宽度 
                        height: height, //高度 
                        text: text_url //任意内容 
                    }); 
                    var renderWay = canvasSupport()? "table": "table";
                    $(".btn-get-more").off("click");
                    $(".btn-contact-us").off("click");
                    $(".btn-get-more").on("click", function() {
                        if($wrapper.hasClass("active")) {
                            $wrapper.removeClass("active");
                        }else {
                            $wrapper.addClass("active");
                        }
                    });
                    var $contactWrap = $(".contact-us-pic");
                    $(".btn-contact-us").on("click", function() {
                        if($contactWrap.hasClass("active")) {
                            $contactWrap.removeClass("active");
                        }else {
                            $contactWrap.addClass("active");
                        }
                    });

                    // $(".btn-get-more").each(function(i,e){
                    //     var text_url = $(this).attr("data-url");
                    //     $(this).qrcode({ 
                    //         render: renderWay, //table方式 
                    //         width: 200, //宽度 
                    //         height:200, //高度 
                    //         text: text_url //任意内容 
                    //     }); 
                    // });
                }
            }); 
            $items.find(".label-box").on("click", function(event) {
                event.stopPropagation();
            });
            $items.find(".label-icon").on("click", function() {
                var id = parseInt($(this).parents(".thumbnail").attr("data-id"));
                var index = allmasonrysData[4].itemsIds.indexOf(id);
                if($(this).hasClass("active")) {
                    // $(this).removeClass("active");
                    if(index != -1) {
                        allmasonrysData[4].itemsIds.splice(index, 1);
                        allItemsData[id-1].isTag = 0;
                        if(!$(".tab-pane").eq(4).hasClass("active")) {
                            $(".tab-pane").eq(4).addClass("active");
                            setTimeout(function() {
                                $(".tab-pane").eq(4).removeClass("active");
                            }, 600);
                        }
                        
                        allmasonrysData[4].masonry.masonry('remove', allmasonrysData[4].masonry.find(".thumbnail[data-id='" + id + "']").parent());
                        allmasonrysData[4].currentIndex--;
                        allmasonrysData[4].masonry.masonry();
                        $(".thumbnail[data-id='" + id + "']").find(".label-icon").removeClass("active");
                    }
                }else {
                    // $(this).addClass("active");
                    if(index == -1) {
                        allmasonrysData[4].itemsIds.push(id);
                        allItemsData[id-1].isTag = 1;
                        appendToMasonry(4);
                        $(".thumbnail[data-id='" + id + "']").find(".label-icon").addClass("active");
                    }
                }
            });
        }
        function getDetailHTML(id) {
            var itemData = allItemsData[id - 1];
            var html = '<div class="col-xs-12 col-sm-4 col-md-4 pop-right pull-right">';
            html += '<div class="thumbnail">';
            html += '<div class="caption"><h3>' + itemData.title + '</h3></div>';
            html += '<div class="img-wave-small"><img src="assets/images/wave_icon_small.png" alt=""></div>';
            if(itemData.desc != "") {
                html += '<div class="description">' + itemData.desc + '</div>';
            }
            html += '<div class="btn-wrap">';
            if(itemData.type == 3) {
                html += '<div></div>';
            }else if(itemData.type == 2) {
                html += '<div class="btn-get-more visible-sm visible-md visible-lg">了解更多</div>';
            }else {
                html += '<div class="btn-get-more-pc visible-sm visible-md visible-lg"><a href="' + itemData.url + '" target="_blank">了解更多</a></div>';
            }
            if(itemData.type != 3) {
                html += '<div class="btn-get-more-mobile visible-xs"><a href="' + itemData.url + '" target="_blank">了解更多</a></div>';
                html += '<div class="qrcode-pic" data-url="' + itemData.url + '"></div>';
            }
            
            html += '<div class="btn-contact-us">联系我们</div>';    
            html += '<div class="contact-us-pic"><img src="assets/images/hina_pic.png" alt=""></div>';   
            html += '</div>';
            html += '</div>';         
            html += '</div>';              
            html += '<div class="col-xs-12 col-sm-8 col-md-8 pop-left">';      
            html += '<div class="thumbnail" data-id="' + itemData.id + '">';   
            for(var i = 0; i < itemData.detailImgs.length; i++) {
                html += '<img src="' + itemData.detailImgs[i] + '" alt="">';
            } 
            html += '<div class="img-wave"><img src="assets/images/wave_icon_big.png" alt=""></div>';
            html += '<div class="caption"><h3>' + itemData.title + '</h3></div>';
            html += '<div class="label-box">';
            for(var i = 0; i < itemData.keywords.length; i++) {
                html += '<span class="label label-diy">' + itemData.keywords[i] + '</span>';
            } 
            if(itemData.isTag) {
                html += '<span class="label-icon pull-right active"></span></div>';
            }else {
                html += '<span class="label-icon pull-right"></span></div>';
            }
            html += '</div>';
            html += '</div>';
            return html;
        }
        function search(keyword) {
            var matchIds = [];
            for(var i = 0; i < allItemsData.length; i++) {
                if(allItemsData[i].title.indexOf(keyword) != -1) {
                    matchIds.push(allItemsData[i].id);
                }else if(allItemsData[i].desc.indexOf(keyword) != -1) {
                    matchIds.push(allItemsData[i].id);
                }else if(allItemsData[i].desc.indexOf(keyword) != -1) {
                    matchIds.push(allItemsData[i].id);
                }else {
                    for(var j = 0; j < allItemsData[i].keywords.length; j++) {
                        if(allItemsData[i].keywords[j].indexOf(keyword) != -1) {
                            matchIds.push(allItemsData[i].id);
                        }
                    }
                }
            }
            allmasonrysData[5].itemsIds = matchIds;
            if(matchIds.length == 0) {
                $(".nav-item").removeClass("active");
                $(".tab-pane").removeClass("active");
                $(".tab-pane").eq(5).addClass("active");
                return;
            }
            allmasonrysData[5].currentIndex = 0;
            allmasonrysData[5].masonry.html("");
            curMasIndex = 5;
            appendToMasonry(curMasIndex, 6, function() {
                $(".nav-item").removeClass("active");
                $(".tab-pane").removeClass("active");
                $(".tab-pane").eq(5).addClass("active");
                allmasonrysData[5].masonry.masonry('destroy');
                allmasonrysData[5].imagesLoading = true;
                allmasonrysData[5].masonry.imagesLoaded( function () {
                    allmasonrysData[5].imagesLoading = false;
                    allmasonrysData[5].masonry.masonry({
                        columnWidth: '.item',
                        itemSelector: '.item'
                    });
                    
                });
            });
            
        }
        initMasonry();
        $(".search-btn").on("click", function() {
            var keyword = $(".search-box").find("input").val();
            if(keyword != "") {
                search(keyword);
            }else {
                $(".nav-item").eq(0).trigger("click");
            }
        });
        $('.search-box').on('keypress',function(event){
            if(event.keyCode == "13") {
                var keyword = $(".search-box").find("input").val();
                if(keyword != "") {
                    search(keyword);
                }else {
                    $(".nav-item").eq(0).trigger("click");
                }
            }
        });
        var headerHeight = $("#header").height();
        var footerHeight = $("#footer").height();
        $(".body").scroll(function() {
            if($("#app").height() + headerHeight - $(this).height()*2 - $(this).scrollTop() < footerHeight) {      
                if(!allmasonrysData[curMasIndex].imagesLoading && curMasIndex != 4) {
                    appendToMasonry(curMasIndex);
                }
            }
        });
    })();


    $('.mini-menu-button').on('click',function () {
        $(this).find('.menu-icon').addClass('open');
        $('html').addClass('mini-nav-is-visible');
        $('#mask').fadeIn();
    });

    $('#mask').on('click',function () {
        $('.menu-icon').removeClass('open');
        $('html').removeClass('mini-nav-is-visible');
        $('#mask').fadeOut();
    });

    $("#mini-nav").find(".mobile-nav-item").on('click',function () {
        $('.menu-icon').removeClass('open');
        $('html').removeClass('mini-nav-is-visible');
        $('#mask').fadeOut();
    });

    $(".pop-close").find("span").on("click", function() {
        $(".body").css({
            "overflow": "auto"
        });
        $("#pop").removeClass("active");
        $(".pop-close").removeClass("active");
    });
    $("#pop").on("touchmove", function(event) {
        event.stopPropagation();
    });

    </script>
</body>
</html>